<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Магазин картин</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app">
        <h1>Магазин картин</h1>
        <p>Нажмите для тестовой покупки:</p>
        <button onclick="sendTestData()">Тестовая покупка</button>
        <div id="products"></div>
        <div id="error" style="color: red;"></div>
    </div>
    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            console.log("Telegram Web App инициализирован");
        } else {
            console.error("Telegram Web App SDK не загружен");
        }

        fetch('/api/products')
            .then(res => {
                if (!res.ok) throw new Error('Не удалось загрузить товары');
                return res.json();
            })
            .then(products => {
                const productsDiv = document.getElementById('products');
                products.forEach(product => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>Цена: ${product.price} USD</p>
                        <img src="${product.image}" alt="${product.name}" style="max-width: 200px;">
                        <button onclick="buyProduct('${product.item_id}', '${product.name}', ${product.price})">Купить</button>
                    `;
                    productsDiv.appendChild(div);
                });
            })
            .catch(err => {
                console.error("Ошибка загрузки товаров:", err);
                document.getElementById('error').innerText = "Ошибка загрузки товаров. Попробуйте позже.";
            });

        function sendTestData() {
            window.Telegram.WebApp.sendData(JSON.stringify({
                item_id: "test",
                item_name: "Тестовый товар",
                price: 100
            }));
        }

        function buyProduct(item_id, item_name, price) {
            window.Telegram.WebApp.sendData(JSON.stringify({
                item_id,
                item_name,
                price
            }));
        }
    </script>
</body>
</html>